Weekly GO-Live SP


SELECT MAP_GROUP_ID 'Product/MapGroup',CUSTOMER.CUSTOMER_ID 'Customer',COMMENT,ITERATION FROM CUSTOMER inner join CUSTOMER_ITERATION on CUSTOMER.CUSTOMER_ID = CUSTOMER_ITERATION.CUSTOMER_ID WHERE CUSTOMER.END_DATE >= DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), -1) and CUSTOMER_ITERATION.END_DATE >= DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), -1) and STATUS = N'G' and IS_CURRENT = 1



 last week

SELECT COUNT(ITERATION) 'Last Week' from CUSTOMER_ITERATION where 
START_DATE >= DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), -8) and
END_DATE <=  DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), -2)




this week

SELECT COUNT(ITERATION) 'This Week' from CUSTOMER_ITERATION where 
END_DATE >=  DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), -1) and 
END_DATE <=DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), +5)


USE [DMF_Dev_New_All]
GO
/****** Object:  StoredProcedure [dbo].[ActiveDataLoadInteractionsSp]    Script Date: 7/21/2020 4:40:23 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[ActiveDataLoadInteractionsSp]
(@InfoBar InfobarType output)
As

--last week
SELECT isNULL(x.CUSTOMER_ID,y.CUSTOMER_ID) 'CUSTOMER',
isNULL(x.[Last Week],0) 'LastWeek',
isNULL(y.[This Week],0) 'ThisWeek',
isNULL(x.[Last Week],0)+isNULL(y.[This Week],0) 'Total' 
from
(
SELECT COUNT(ITERATION) 'Last Week',CUSTOMER_ID from CUSTOMER_ITERATION where 
START_DATE >= DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), -8) and
END_DATE <=  DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), -2) group by CUSTOMER_ID

) x
full outer join

--this week
(
SELECT COUNT(ITERATION) 'This Week',CUSTOMER_ID from CUSTOMER_ITERATION where 
END_DATE >=  DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), -1) and 
END_DATE <=DATEADD(WEEK, DATEDIFF(WEEK, 0, GETDATE()), +5) group by CUSTOMER_ID
) y  
ON (x.CUSTOMER_ID = y.CUSTOMER_ID);

Go


